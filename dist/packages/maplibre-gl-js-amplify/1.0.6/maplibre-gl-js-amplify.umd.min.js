!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@aws-amplify/core"),require("@aws-amplify/geo"),require("maplibre-gl"),require("@maplibre/maplibre-gl-geocoder"),require("@maplibre/maplibre-gl-geocoder/dist/maplibre-gl-geocoder.css")):"function"==typeof define&&define.amd?define(["exports","@aws-amplify/core","@aws-amplify/geo","maplibre-gl","@maplibre/maplibre-gl-geocoder","@maplibre/maplibre-gl-geocoder/dist/maplibre-gl-geocoder.css"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).maplibreAmplify={},e.aws_amplify_core,e.aws_amplify_geo,e.maplibregl,e.MaplibreGeocoder)}(this,(function(e,t,r,o,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=i(o),s=i(n);function c(e){return Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]}const l=e=>{let t;return t=c(e[0])?e.map((e=>({type:"Feature",geometry:{type:"Point",coordinates:e},properties:{place_name:`Coordinates,${e}`}}))):e,t};var u=function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},d=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r};class p{constructor(e,r){this.refreshCredentials=()=>u(this,void 0,void 0,(function*(){try{this.credentials=yield t.Amplify.Auth.currentCredentials()}catch(e){throw console.error(`Failed to refresh credentials: ${e}`),e}})),this.refreshCredentialsWithRetry=()=>u(this,void 0,void 0,(function*(){yield t.jitteredExponentialRetry(this.refreshCredentials,[],3e5),this.activeTimeout&&clearTimeout(this.activeTimeout);const e=new Date(this.credentials.expiration).getTime()-(new Date).getTime()-1e4;this.activeTimeout=window.setTimeout(this.refreshCredentialsWithRetry,e)})),this.transformRequest=(e,r)=>{if("Style"!==r||e.includes("://")||(e=`https://maps.geo.${this.region}.amazonaws.com/maps/v0/maps/${e}/style-descriptor`),e.includes("amazonaws.com")){const r=e+`?x-amz-user-agent=${encodeURIComponent((o=t.getAmplifyUserAgent(),o.replace(/\./g,"%2E")))}`;return{url:t.Signer.signUrl(r,{access_key:this.credentials.accessKeyId,secret_key:this.credentials.secretAccessKey,session_token:this.credentials.sessionToken})}}var o},this.credentials=e,this.region=r,this.activeTimeout=null,this.refreshCredentialsWithRetry(),t.Hub.listen("auth",(e=>{switch(e.payload.event){case"signIn":case"signOut":case"tokenRefresh":this.refreshCredentialsWithRetry()}}))}}p.createMapLibreMap=e=>u(void 0,void 0,void 0,(function*(){const{region:n,mapConstructor:i=o.Map}=e,a=d(e,["region","mapConstructor"]),s=r.Geo.getDefaultMap(),c=new p(yield t.Amplify.Auth.currentCredentials(),n||s.region).transformRequest;return new i(Object.assign(Object.assign({},a),{style:e.style||s.mapName,transformRequest:c}))}));const f="#fff",y="#5d8aff";var m;!function(e){e.ESRI_TOPOGRAPHIC="VectorEsriTopographic",e.ESRI_STREETS="VectorEsriStreets",e.ESRI_LIGHT_GRAY="VectorEsriLightGrayCanvas",e.ESRI_DARK_GRAY="VectorEsriDarkGrayCanvas",e.ESRI_NAVIGATION="VectorEsriNavigation",e.HERE_BERLIN="VectorHereBerlin"}(m||(m={}));const h={[m.ESRI_TOPOGRAPHIC]:"Noto Sans Regular",[m.ESRI_STREETS]:"Arial Regular",[m.ESRI_LIGHT_GRAY]:"Ubuntu Regular",[m.ESRI_DARK_GRAY]:"Ubuntu Regular",[m.ESRI_NAVIGATION]:"Arial Regular",[m.HERE_BERLIN]:"Fira GO Regular"};function g(e){const t=(null==e?void 0:e.fillColor)?e.fillColor:y,r=(null==e?void 0:e.strokeColor)?e.strokeColor:f,o=(null==e?void 0:e.lineWidth)?e.lineWidth:4;return{width:64,height:64,data:new Uint8Array(16384),onAdd:function(){const e=document.createElement("canvas");e.width=this.width,e.height=this.height,this.context=e.getContext("2d")},render:function(){const e=this.context,n=new Path2D("M24.8133 38.533C18.76 31.493 13 28.8264 13 20.8264C13.4827 14.9864 16.552 9.67169 21.368 6.33302C33.768 -2.26165 50.824 5.78902 52.0667 20.8264C52.0667 28.613 46.5733 31.6797 40.6533 38.373C32.4933 47.5464 35.4 63.093 32.4933 63.093C29.72 63.093 32.4933 47.5464 24.8133 38.533ZM32.4933 8.23969C26.5573 8.23969 21.7467 13.0504 21.7467 18.9864C21.7467 24.9224 26.5573 29.733 32.4933 29.733C38.4293 29.733 43.24 24.9224 43.24 18.9864C43.24 13.0504 38.4293 8.23969 32.4933 8.23969Z");return e.stroke(n),e.fillStyle=t,e.strokeStyle=r,e.lineWidth=o,e.fill(n),this.data=e.getImageData(0,0,this.width,this.height).data,!0}}}var b=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r};const v="amplify-tip";function C(e,t,r){var{showMarkerPopup:n=!1}=r,i=b(r,["showMarkerPopup"]);const a=`${e}-layer-unclustered-point`,s=function(e,{popupBackgroundColor:t="#fff",popupBorderColor:r="#0000001f",popupBorderWidth:o=2,popupFontColor:n="#000",popupPadding:i=20,popupBorderRadius:a=4,popupTitleFontWeight:s="bold"}){return c=>{let l,u;if("string"==typeof(d=c.properties.place_name)&&d.length>0){const e=c.properties.place_name.split(",");l=e[0],u=e.splice(1,e.length).join(",")}else l="Coordinates",u=c.geometry.coordinates;var d;return`\n      <div class="${e}-popup" style="background: ${t}; border: ${o}px solid ${r}; color: ${n}; border-radius: ${a}px; padding: ${i}px; word-wrap: break-word; margin: -10px -10px -15px;">\n        <div class="${e}-popup-title" style="font-weight: ${s};">\n          ${l}\n        </div>\n        <div class="${e}-popup-address">\n          ${u}\n        </div>\n      </div>`}}(a,i);!function(e,{selectedColor:t="#ff9900",selectedBorderColor:r="#fff",selectedBorderWidth:o=4,defaultBorderColor:n="#fff",defaultBorderWidth:i=4,defaultColor:a="#5d8aff"}){const s=g({fillColor:a,strokeColor:n,lineWidth:i}),c=g({fillColor:t,strokeColor:r,lineWidth:o});e.addImage("inactive-marker",s,{pixelRatio:2}),e.addImage("active-marker",c,{pixelRatio:2})}(t,i);const l={id:a,type:"symbol",source:e,filter:["!",["has","point_count"]],layout:{"icon-image":"inactive-marker"}};if(t.addLayer(Object.assign({},l)),n){if(!document.getElementById(v)){const e=document.createElement("style");e.setAttribute("id",v),document.head.append(e),e.textContent=".mapboxgl-popup-tip { display: none; }"}}return t.on("click",a,(function(e){if("function"==typeof i.onClick&&i.onClick(e),t.setLayoutProperty(a,"icon-image",["match",["id"],e.features[0].id,"active-marker","inactive-marker"]),n){const r=e.features[0],n=r.geometry.coordinates;c(n)&&(new o.Popup).setLngLat(n).setHTML(s(r)).setOffset(15).addTo(t)}})),{unclusteredLayerId:a}}function w(){const e=new Image(24,24);return e.src='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">\n    <circle fill="white" cx="51%" cy="7" r="5" />\n    <path\n        fill="#5d8aff"\n        d="M24.8133 38.533C18.76 31.493 13 28.8264 13 20.8264C13.4827 14.9864 16.552 9.67169 21.368 6.33302C33.768 -2.26165 50.824 5.78902 52.0667 20.8264C52.0667 28.613 46.5733 31.6797 40.6533 38.373C32.4933 47.5464 35.4 63.093 32.4933 63.093C29.72 63.093 32.4933 47.5464 24.8133 38.533ZM32.4933 8.23969C26.5573 8.23969 21.7467 13.0504 21.7467 18.9864C21.7467 24.9224 26.5573 29.733 32.4933 29.733C38.4293 29.733 43.24 24.9224 43.24 18.9864C43.24 13.0504 38.4293 8.23969 32.4933 8.23969Z"\n    />\n</svg>',e}var O=function(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},R=function(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r};const x={forwardGeocode:e=>O(void 0,void 0,void 0,(function*(){const t=[];try{const o=yield r.Geo.searchByText(e.query,{biasPosition:e.proximity,searchAreaConstraints:e.bbox,countries:e.countires,maxResults:e.limit});o&&o.forEach((e=>{const{geometry:r}=e,o=R(e,["geometry"]);t.push({type:"Feature",geometry:{type:"Point",coordinates:r.point},properties:Object.assign({},o),place_name:o.label,text:o.label,center:r.point})}))}catch(e){console.error(`Failed to forwardGeocode with error: ${e}`)}return{features:t}})),reverseGeocode:e=>O(void 0,void 0,void 0,(function*(){const t=[];try{const o=yield r.Geo.searchByCoordinates(e.query,{maxResults:e.limit});if(o&&o.geometry){const{geometry:e}=o,r=R(o,["geometry"]);t.push({type:"Feature",geometry:{type:"Point",coordinates:e.point},properties:Object.assign({},r),place_name:r.label,text:r.label,center:e.point})}}catch(e){console.error(`Failed to reverseGeocode with error: ${e}`)}return{features:t}}))};e.AmplifyGeocoderAPI=x,e.AmplifyMapLibreRequest=p,e.createAmplifyGeocoder=function(e){return new s.default(x,Object.assign({maplibregl:a.default,showResultMarkers:{element:w()}},e))},e.createDefaultIcon=w,e.createMap=e=>u(void 0,void 0,void 0,(function*(){return p.createMapLibreMap(e)})),e.drawPoints=function(e,t,o,{showCluster:n=!0,clusterOptions:i={},unclusteredOptions:a={}}={},s){var c;if(!o||"function"!=typeof o.addSource||"function"!=typeof o.addLayer)throw new Error("Please use a maplibre map");const u=l(t),d=`${e}-source-points`;let p,f;o.addSource(d,{type:"geojson",data:{type:"FeatureCollection",features:u},cluster:n,clusterMaxZoom:null!==(c=i.clusterMaxZoom)&&void 0!==c?c:14,generateId:!0}),n&&({clusterLayerId:p,clusterSymbolLayerId:f}=function(e,t,{fillColor:o="#5d8aff",smCircleSize:n=60,smThreshold:i=50,mdCircleSize:a=100,mdThreshold:s=100,lgCircleSize:c=140,lgThreshold:l=500,xlCircleSize:u=180,borderWidth:d=4,borderColor:p="#fff",clusterPaint:f,onClick:y,showCount:m,clusterCountLayout:g,fontColor:b="#fff"},v){const C=`${e}-layer-clusters`,w=`${e}-layer-cluster-count`,O=Object.assign({"circle-color":["step",["get","point_count"],o,i,o,s,o,l,o],"circle-radius":["step",["get","point_count"],n,i,a,s,c,l,u],"circle-stroke-width":d,"circle-stroke-color":p},f),R={id:C,type:"circle",source:e,filter:["has","point_count"],paint:O};if(t.addLayer(Object.assign({},R)),t.on("click",C,(function(r){"function"==typeof y&&y(r);const o=t.queryRenderedFeatures(r.point,{layers:[C]}),n=o[0].properties.cluster_id,i=t.getSource(e);(function(e){return"geojson"===e.type})(i)&&i.getClusterExpansionZoom(n,(function(e,r){e||t.easeTo({center:o[0].geometry.coordinates,zoom:r})}))})),m){const o={"text-field":"{point_count_abbreviated}","text-size":24},n=v||r.Geo.getDefaultMap().style;n&&(o["text-font"]=[h[n]]);const i=Object.assign(Object.assign({},o),g),a={id:w,type:"symbol",source:e,filter:["has","point_count"],layout:i,paint:{"text-color":b}};t.addLayer(Object.assign({},a))}return{clusterLayerId:C,clusterSymbolLayerId:w}}(d,o,i,s));const{unclusteredLayerId:y}=C(d,o,a||{});return{sourceId:d,unclusteredLayerId:y,clusterLayerId:p,clusterSymbolLayerId:f}},Object.defineProperty(e,"__esModule",{value:!0})}));